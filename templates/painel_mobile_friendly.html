<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel do Bot - Mobile Friendly</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 10px; background: #121212; color: #f5f5f5; }
        .info, .acoes { background: #1e1e1e; padding: 15px; border-radius: 8px; margin-bottom: 15px; }
        h1 { color: #03dac6; font-size: 1.5em; text-align: center; }
        .label { font-weight: bold; display: block; margin-top: 8px; }
        button, select { padding: 10px; margin-top: 10px; width: 100%; border-radius: 4px; border: none; background: #03dac6; color: #000; font-weight: bold; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.9em; }
        th, td { border: 1px solid #333; padding: 6px; text-align: center; }
        th { background: #333; }
        @media (max-width: 600px) {
            .info, .acoes { padding: 10px; }
            h1 { font-size: 1.2em; }
            table, th, td { font-size: 0.8em; }
        }
    </style>
    <script>
        function atualizarStatus() {
            fetch('/status').then(res => res.json()).then(data => {
                document.getElementById("modoAtual").innerText = data.modo;
                document.getElementById("estadoAtual").innerText = data.ativo ? "Ativo" : "Parado";
                document.getElementById("saldoAtual").innerText = data.valor_disponivel;
                document.getElementById("moedas").innerText = data.moedas_monitoradas.join(", ");
            });
            fetch('/operacoes').then(res => res.json()).then(ops => {
                const tbody = document.getElementById("operacoesBody");
                tbody.innerHTML = "";
                ops.forEach(op => {
                    tbody.innerHTML += `<tr>
                        <td>${op.symbol}</td>
                        <td>${op.preco}</td>
                        <td>${op.data}</td>
                        <td>${op.acao}</td>
                    </tr>`;
                });
            });
        }
        function alterarModo() {
            const modo = document.getElementById("modoSelect").value;
            fetch('/modo', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ modo: modo }) }).then(() => atualizarStatus());
        }
        function ativarBot(ativo) {
            fetch(ativo ? '/bot/start' : '/bot/stop', { method: 'POST' }).then(() => atualizarStatus());
        }
        setInterval(atualizarStatus, 5000);
        window.onload = atualizarStatus;
    </script>
    <link rel="manifest" href="/static/manifest.json">
<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/static/service-worker.js');
  }
</script>
</head>
<body>
    <h1>Painel do Bot</h1>

    <div class="info">
        <span class="label">Modo atual:</span> <span id="modoAtual">{{ modo }}</span>
        <span class="label">Estado do bot:</span> <span id="estadoAtual">{{ ativo }}</span>
        <span class="label">Saldo disponível:</span> <span id="saldoAtual">{{ saldo }}</span>
        <span class="label">Moedas monitoradas:</span> <span id="moedas">{{ moedas }}</span>
    </div>

    <div class="acoes">
        <label for="modoSelect">Alterar modo:</label>
        <select id="modoSelect">
            <option value="agressivo">Agressivo</option>
            <option value="moderado">Moderado</option>
            <option value="manual">Manual</option>
        </select>
        <button onclick="alterarModo()">Enviar</button>
        <button onclick="ativarBot(true)">Ativar Bot</button>
        <button onclick="ativarBot(false)">Parar Bot</button>
    </div>

    <div class="info">
        <h2>Histórico</h2>
        <table>
            <thead>
                <tr><th>Moeda</th><th>Preço</th><th>Data</th><th>Ação</th></tr>
            </thead>
            <tbody id="operacoesBody"></tbody>
        </table>
    </div>
</body>
</html>
